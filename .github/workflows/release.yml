name: Create Release

on:
  push:
    tags:
      - 'v*'

jobs:
  create-release:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
    
    - name: Build executable
      run: |
        pyinstaller --onefile --windowed --name "Steam_Connection_Controller" steam_connection_controller.py
    
    - name: Create release package
      run: |
        mkdir release
        copy dist\Steam_Connection_Controller.exe release\
        copy steam_controller.bat release\
        copy README.md release\
        copy LICENSE release\
        copy test_program.py release\
    
    - name: Create ZIP archive
      run: |
        powershell Compress-Archive -Path release\* -DestinationPath Steam_Connection_Controller_${{ github.ref_name }}.zip
    
    - name: Get release info
      id: release_info
      run: |
        echo "tag_name=${{ github.ref_name }}" >> $GITHUB_OUTPUT
        echo "release_name=Steam Connection Controller ${{ github.ref_name }}" >> $GITHUB_OUTPUT
    
    - name: Create Release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ steps.release_info.outputs.tag_name }}
        release_name: ${{ steps.release_info.outputs.release_name }}
        body: |
          ## Steam BaÄŸlantÄ± KontrolcÃ¼sÃ¼ ${{ steps.release_info.outputs.tag_name }}
          
          ### ğŸ‰ Yeni SÃ¼rÃ¼m Ã–zellikleri
          - Steam'Ä±n internet baÄŸlantÄ±sÄ±nÄ± tek tÄ±kla kontrol edin
          - KullanÄ±cÄ± dostu arayÃ¼z
          - Otomatik Steam tespit sistemi
          - GÃ¼venli Windows Firewall entegrasyonu
          
          ### ğŸ“¦ Ä°ndirme
          - **Steam_Connection_Controller_${{ steps.release_info.outputs.tag_name }}.zip**: Tam paket (Ã¶nerilen)
          - **Steam_Connection_Controller.exe**: Sadece Ã§alÄ±ÅŸtÄ±rÄ±labilir dosya
          
          ### ğŸš€ Kurulum
          1. ZIP dosyasÄ±nÄ± indirin ve Ã§Ä±karÄ±n
          2. `steam_controller.bat` dosyasÄ±nÄ± **yÃ¶netici olarak Ã§alÄ±ÅŸtÄ±rÄ±n**
          3. Program otomatik olarak Steam'Ä± bulacak ve Ã§alÄ±ÅŸmaya baÅŸlayacak
          
          ### âš ï¸ Gereksinimler
          - Windows 10/11
          - YÃ¶netici yetkisi
          - Steam kurulu olmalÄ±
          
          ### ğŸ› Bilinen Sorunlar
          - Ä°lk Ã§alÄ±ÅŸtÄ±rmada Windows Defender uyarÄ±sÄ± Ã§Ä±kabilir (gÃ¼venli dosyadÄ±r)
          
          ### ğŸ“ Destek
          SorunlarÄ±nÄ±z iÃ§in [Issues](https://github.com/username/steam-connection-controller/issues) bÃ¶lÃ¼mÃ¼nÃ¼ kullanÄ±n.
        draft: false
        prerelease: false
    
    - name: Upload ZIP Release Asset
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: ./Steam_Connection_Controller_${{ github.ref_name }}.zip
        asset_name: Steam_Connection_Controller_${{ github.ref_name }}.zip
        asset_content_type: application/zip
    
    - name: Upload EXE Release Asset
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: ./dist/Steam_Connection_Controller.exe
        asset_name: Steam_Connection_Controller.exe
        asset_content_type: application/octet-stream