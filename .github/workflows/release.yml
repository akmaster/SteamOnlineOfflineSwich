name: Create Release

on:
  push:
    tags:
      - 'v*'

jobs:
  create-release:
    runs-on: windows-latest
    
    permissions:
      contents: write
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller psutil
    
    - name: Build executable
      run: |
        pyinstaller --onefile --windowed --name "GameClientController" game_client_controller.py
    
    - name: Create release package
      run: |
        mkdir release
        copy dist\GameClientController.exe release\
        copy README.md release\
        copy LICENSE release\
        copy CHANGELOG.md release\
        copy requirements.txt release\
        copy test_program.py release\
        copy game_client_controller.bat release\GameClientController.bat
        echo @echo off > release\GameClientController.bat
        echo title Game Client Connection Controller >> release\GameClientController.bat
        echo echo Starting Game Client Connection Controller... >> release\GameClientController.bat
        echo echo. >> release\GameClientController.bat
        echo echo Note: This program requires administrator privileges. >> release\GameClientController.bat
        echo echo. >> release\GameClientController.bat
        echo GameClientController.exe >> release\GameClientController.bat
        echo pause >> release\GameClientController.bat
    
    - name: Create ZIP archive
      run: |
        powershell Compress-Archive -Path release\* -DestinationPath GameClientController_${{ github.ref_name }}.zip
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        name: Game Client Connection Controller ${{ github.ref_name }}
        body: |
          ## Game Client Connection Controller ${{ github.ref_name }}
          
          ### ğŸ‰ New Release Features
          - Control internet connection for multiple game clients (Steam, Ubisoft Connect, EA Play, Rockstar Launcher)
          - User-friendly interface
          - Automatic client detection system
          - Secure Windows Firewall integration
          - Automatic client management (close/restart)
          
          ### ğŸ“¦ Download
          - **GameClientController_${{ github.ref_name }}.zip**: Complete package (recommended)
          - **GameClientController.exe**: Standalone executable file
          
          ### ğŸš€ Installation
          1. Download the ZIP file and extract it
          2. Run `GameClientController.bat` **as administrator**
          3. The program will automatically find installed clients and start working
          
          ### âš ï¸ Requirements
          - Windows 10/11
          - Administrator privileges
          - Supported game client(s) must be installed
          
          ### ğŸ› Known Issues
          - Windows Defender warning may appear on first run (safe file)
          
          ### ğŸ“ Support
          For issues, use the [Issues](https://github.com/akmaster/SteamOnlineOfflineSwich/issues) section.
        files: |
          GameClientController_${{ github.ref_name }}.zip
          dist/GameClientController.exe
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
